import{r as t,J as C,j as s,C as P,P as O,A as E,t as L,H as B}from"./index-BLD4AiPq.js";import{c as b,s as _,A as U,a as F,C as S,S as k,D as H,d as W}from"./index-B8iWiN0G.js";import{r as y,C as V,e as w,l as Q,k as q}from"./index-C_v-ZTEZ.js";import{L as X}from"./index-DndKYHcj.js";var x=(e=>(e[e.unset=0]="unset",e[e.loaded=1]="loaded",e[e.fadeIn=2]="fadeIn",e[e.loop=3]="loop",e[e.fadeOut=4]="fadeOut",e))(x||{}),m=(e=>(e.landing="landing",e.choose="choose",e))(m||{});const A={page:"landing",step:0,locationIndex:Math.floor(Math.random()*3),steamImageLoaded:!1,smokeImageLoaded:!0,videoLoadedIndex:0},v=t.createContext([A,()=>{}]);var h=(e=>(e[e.unset=0]="unset",e[e.fadeOut=1]="fadeOut",e[e.fadeIn=2]="fadeIn",e))(h||{});const R={step:0,index:0,lastIndex:0},N=t.createContext([R,()=>{}]),Y=t.memo(()=>{const e=t.useId(),n=t.useId(),[{step:a},c]=t.useContext(N);return t.useEffect(()=>{C.add(`#${e}`,()=>{a===h.unset&&c(o=>({...o,step:h.fadeOut,lastIndex:o.index,index:(o.index+2)%3}))}),C.add(`#${n}`,()=>{a===h.unset&&c(o=>({...o,step:h.fadeOut,lastIndex:o.index,index:(o.index+1)%3}))})},[a]),s.jsx("div",{className:"Arrow",children:s.jsxs("div",{className:"cistern",children:[s.jsx("div",{id:e,className:"[&_*]:pointer-events-none",children:s.jsx("div",{})}),s.jsx("div",{id:n,className:"[&_*]:pointer-events-none",children:s.jsx("div",{})})]})})}),G=t.memo(()=>{const[,e]=t.useContext(P),n=t.useId(),[{index:a},c]=t.useContext(N),[{step:o,page:i},l]=t.useContext(v),[u,d]=y({opacity:0,scale:2}),[r,f]=t.useState(!1);return t.useEffect(()=>{o>=x.fadeIn&&i===m.choose&&d({opacity:1,scale:1},{duration:500,delay:1500,onEnd:()=>{f(!0)}})},[i,o]),t.useEffect(()=>{C.add(`#${n}`,()=>{const j=[O.taipei,O.zhongli,O.chiayi][Math.max(Math.min(a,2),0)];e({type:E.Page,state:j}),e({type:E.location,state:j}),c(R),l({...A,page:m.choose})})},[a]),s.jsx("div",{className:"Button",children:s.jsx("div",{id:n,className:L("button",r&&"cursor-pointer"),style:u,children:s.jsx("div",{children:s.jsx("div",{})})})})}),J=t.memo(({index:e})=>{const[n,a]=y({opacity:0,y:50});return t.useEffect(()=>{a({opacity:1,y:0},{delay:300+100*e,duration:500})},[]),s.jsx("div",{style:n,children:s.jsx("div",{})})}),K=t.memo(()=>s.jsx("div",{className:"text",children:[...new Array(2).keys()].map(e=>s.jsx(J,{index:e},e))})),Z=t.memo(()=>s.jsx("div",{className:"Description",children:s.jsx(K,{})})),T=t.memo(({active:e})=>{const[n,a]=y({opacity:0,scale:2});return t.useEffect(()=>{e?a({opacity:0,scale:2},{duration:1,onEnd:()=>{a({opacity:1,scale:1},{delay:1e3,duration:500})}}):a({opacity:0,scale:1},200)},[e]),s.jsx("div",{style:n})}),ee=t.memo(({index:e})=>{const[{index:n,step:a,lastIndex:c},o]=t.useContext(N),[i,l]=y({opacity:0,y:-80,x:-20,rotate:0});return t.useEffect(()=>{a===h.unset&&e===n&&l({opacity:1,y:0,x:0},{delay:200,duration:600}),a===h.fadeIn&&e===n&&l({opacity:0,y:-80,x:-20,rotate:0},{duration:1,onEnd:()=>{l({opacity:1,y:0,x:0},{duration:600,onEnd:()=>{o(u=>({...u,step:h.unset}))}})}}),a===h.fadeOut&&e===c&&l({opacity:0,rotate:-24,y:500},{duration:800,easing:w.inQuart,onEnd:()=>{o(u=>({...u,step:h.fadeIn}))}})},[n,a]),s.jsx("div",{className:L("file",`file-${e}`),style:i,children:s.jsx("div",{children:s.jsx("div",{children:s.jsx(T,{active:e===n})})})},`file-${e}`)}),te=t.memo(()=>{const[{step:e,page:n}]=t.useContext(v),[a,c]=y({opacity:0,scale:1.2});return t.useEffect(()=>{e>=x.fadeIn&&n===m.choose&&c({opacity:1,scale:1})},[n,e]),s.jsx("div",{className:"Folder",style:a,children:s.jsx(V,{children:s.jsx("div",{className:"bg-cover",children:[...new Array(3).keys()].map(o=>s.jsx(ee,{index:o},`file-${o}`))})})})}),se=t.memo(()=>{const[{step:e},n]=t.useContext(N),a=t.useRef({x:0,y:0,isDown:!1}),c=l=>{const{clientX:u,clientY:d}=l;a.current={x:u,y:d,isDown:!0}},o=l=>{const{clientX:u,clientY:d}=l;if(a.current.isDown){const r=u-a.current.x,f=d-a.current.y;if(Math.sqrt(r*r+f*f)>50){const p=Math.abs(Math.atan2(f,r)*(180/Math.PI));if(p<45||p>135){const I=p>90?"right":"left";a.current.isDown=!1,a.current.x=0,a.current.y=0,I==="left"?e===h.unset&&n(g=>({...g,step:h.fadeOut,lastIndex:g.index,index:(g.index+2)%3})):e===h.unset&&n(g=>({...g,step:h.fadeOut,lastIndex:g.index,index:(g.index+1)%3}))}}}},i=()=>{a.current.isDown=!1};return s.jsx("div",{className:"Touch",onPointerDown:c,onPointerMove:o,onPointerUp:i})}),ne=t.memo(()=>{const e=t.useState(R),[{page:n}]=t.useContext(v);return s.jsx(N.Provider,{value:e,children:s.jsxs("div",{className:L("Choose absolute top-0 h-full w-full overflow-hidden",n===m.choose?"visible":"invisible"),children:[s.jsx(te,{}),s.jsx(Z,{}),s.jsx(se,{}),s.jsx(Y,{}),s.jsx(G,{})]})})}),ae=""+new URL("bg-chiayi-DVzF5jNX.mp4",import.meta.url).href,M=""+new URL("bg-taipei-B3PRqyLJ.mp4",import.meta.url).href,ie=""+new URL("bg-zhongli-BIB2Hj-f.mp4",import.meta.url).href,oe=({children:e,index:n})=>{const[{locationIndex:a,page:c},o]=t.useContext(v),i=t.useRef(a),[l,u]=y({opacity:0}),d=t.useRef(null),r=t.useRef(null),[f,j]=t.useState({width:0,height:0,top:0,left:0});return t.useEffect(()=>{const p=()=>{d.current&&j(Q.CoverSize({width:1280,height:1920},{width:d.current.clientWidth,height:d.current.clientHeight}))};p(),window.addEventListener("resize",p);const I=()=>{o($=>({...$,videoLoadedIndex:$.videoLoadedIndex+1})),r.current?.removeEventListener("loadeddata",I),r.current?.removeEventListener("playing",I)};r.current?.readyState===0?r.current?.addEventListener("loadeddata",I):r.current?.addEventListener("playing",I);const g=()=>{r.current&&(r.current.currentTime=0,r.current.play())};return r.current?.addEventListener("ended",g),r.current?.addEventListener("pause",()=>{r.current&&(r.current.currentTime=0,r.current.play())}),()=>{window.removeEventListener("resize",p)}},[]),t.useEffect(()=>{if(i.current===a){n===a%3&&u({opacity:1},1);return}n===a%3?u({opacity:1},{duration:2e3,delay:300,easing:w.inQuart,onStart:()=>{r.current&&(r.current.currentTime=0,r.current.play())}}):u({opacity:0},{duration:2e3,easing:w.outQuart})},[a]),t.useEffect(()=>{c===m.choose?r.current?.pause():c===m.landing&&r.current?.play().catch(p=>{p.name==="NotAllowedError"&&n===0&&alert("請關閉手機低耗電模式，關閉後再重新試一次")})},[c]),s.jsx("div",{ref:d,className:"absolute top-0 left-0 h-full w-full",style:l,children:s.jsxs("div",{className:"absolute",style:{width:`${f.width}px`,height:`${f.height}px`,top:`${f.top}px`,left:`${f.left}px`},children:[e,s.jsx(_,{ref:r,src:[M,ie,ae][n]||M,width:"100%",height:"100%",autoPlay:!0,loop:!0,playbackRate:1,playsInline:!0,muted:!0})]})})},re=t.memo(()=>{const[{step:e,locationIndex:n},a]=t.useContext(v),[c,o]=y({opacity:0,scale:1}),i=t.useRef(n),[l,u]=t.useState(n);return t.useEffect(()=>{i.current!==l&&a(d=>({...d,locationIndex:l}))},[l]),t.useEffect(()=>{e===x.fadeIn?o({opacity:1},{duration:2e3}):e===x.fadeOut&&(b.stop(),b.destroy(),o({opacity:0,scale:1.2},{duration:1200,easing:w.inOutQuart,onEnd:()=>{a(d=>({...d,page:m.choose}))}})),e===x.loop&&(b.add(({delta:d})=>{u(i.current+Math.floor(d/B))}),b.play())},[e]),s.jsx("div",{className:"Background h-full w-full",style:c,children:[...new Array(3).keys()].map(d=>s.jsx(oe,{index:d,children:s.jsx("div",{className:`bg-${d}`})},`bg-${d}`))})}),ce=t.memo(({index:e})=>{const[{step:n}]=t.useContext(v),[a,c]=y({opacity:0,y:50});return t.useEffect(()=>{n===x.fadeIn?c({opacity:1,y:0},{duration:2e3,delay:1e3+e*200,easing:w.inOutCubic}):n===x.fadeOut&&c({opacity:0},500)},[n]),s.jsx("div",{style:a,children:s.jsx("div",{})})}),de=t.memo(()=>s.jsx("div",{className:"body",children:[...new Array(2).keys()].map(e=>s.jsx(ce,{index:e},e))})),le=t.memo(()=>{const e=t.useId(),[{step:n},a]=t.useContext(v),[c,o]=y({opacity:0,scale:2});return t.useEffect(()=>{n===x.fadeIn?o({opacity:1,scale:1},{duration:500,delay:3500,easing:w.outBack,onEnd:()=>{a(i=>({...i,step:x.loop}))}}):n===x.fadeOut&&o({opacity:0,scale:1},1)},[n]),t.useEffect(()=>{C.add(`#${e}`,()=>{n===x.loop&&(a(i=>({...i,step:x.fadeOut})),C.remove(`#${e}`))})},[n]),s.jsx("div",{className:L("button",n===x.loop&&"cursor-pointer"),children:s.jsx("div",{id:e,style:c,className:"[&_*]:pointer-events-none",children:s.jsx("div",{children:s.jsx("div",{className:"start"})})})})}),D=""+new URL("displacement_map_repeat-CNM4-aIj.jpg",import.meta.url).href,z=""+new URL("headline-animate-DogYC3oN.png",import.meta.url).href,ue=t.memo(()=>{const e=t.useRef(null),[{step:n},a]=t.useContext(v),[c,o]=y({opacity:0,y:0,scale:1.2});return t.useEffect(()=>{const i=new U,l=()=>{i.stage.children.forEach(d=>{d instanceof S&&e.current&&(d.scale.set(.55/259*e.current.clientWidth),i.canvas.width=e.current.clientWidth||259,i.canvas.height=(e.current.clientHeight||172)+200,i.renderer.resize(i.canvas.width,i.canvas.height))})},u=async()=>{if(e.current&&e.current.clientWidth>0&&e.current.clientHeight>0){await F.load([z,D]),await i.init({width:e.current.clientWidth||259,height:(e.current.clientHeight||172)+200,backgroundAlpha:0}),i.stage.eventMode="static",i.stage.width=e.current.clientWidth||259,i.stage.height=(e.current.clientHeight||172)+200,e.current.appendChild(i.canvas);const d=new S;d.scale.set(.55/259*e.current.clientWidth),i.stage.addChild(d);const r=k.from(z);d.addChild(r),r.x=100,r.y=100;const f=k.from(D);f.texture.source.addressMode="repeat";const j=new H({sprite:f,scale:{x:30,y:10}});j.padding=10,f.position=r.position,i.stage.addChild(f),r.filters=[j],i.ticker.add(()=>{f.x++,f.x>f.width&&(f.x=0)}),a(p=>({...p,steamImageLoaded:!0})),l(),window.addEventListener("resize",l)}else requestAnimationFrame(()=>{u()})};return requestAnimationFrame(()=>{u()}),()=>{window.removeEventListener("resize",l),i.destroy()}},[]),t.useEffect(()=>{n===x.fadeIn?o({opacity:1,y:0,scale:1},{duration:2e3,delay:500,easing:w.inOutCubic}):n===x.fadeOut&&o({opacity:0,scale:1.2},{duration:500,easing:w.outQuart})},[n]),s.jsx("div",{className:"headline",style:c,children:s.jsx("div",{children:s.jsx("div",{children:s.jsx("div",{ref:e,className:"haunted-text"})})})})}),fe=t.memo(()=>s.jsxs("div",{className:"Header",children:[s.jsx(ue,{}),s.jsx(de,{}),s.jsx(le,{})]})),xe=t.memo(()=>{const[{page:e}]=t.useContext(v);return s.jsxs("div",{className:L("Landing absolute h-full w-full overflow-hidden",e===m.landing?"visible":"invisible"),children:[s.jsx(re,{}),s.jsx(X,{}),s.jsx(fe,{})]})}),ve=t.memo(()=>{const[,e]=t.useContext(P),[n,a]=t.useState(A);return t.useEffect(()=>{n.page===m.landing?e({type:E.smokeEffect,state:!0}):e({type:E.smokeEffect,state:!1})},[n.page]),t.useEffect(()=>{e({type:E.LoadingProcess,state:{enabled:!0}})},[]),t.useEffect(()=>{const{step:c,smokeImageLoaded:o,steamImageLoaded:i,videoLoadedIndex:l}=n;c===x.loaded&&o&&i&&l===3&&(e({type:E.LoadingProcess,state:{enabled:!1}}),a(u=>({...u,step:x.fadeIn})))},[n]),s.jsx(v.Provider,{value:[n,a],children:s.jsx(q,{onload:()=>{a(c=>({...c,step:x.loaded}))},children:s.jsx("div",{className:"Home",children:s.jsxs(W,{children:[s.jsx(xe,{}),s.jsx(ne,{})]})})})})});export{ve as default};
